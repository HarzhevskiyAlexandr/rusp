## Что было раньше
В движке всё было основано на  том, что:

 * у всех картинок был id в базе 
 * поэтому url к кртинке имел виду `/getimage/12345/257x121xS/`
 * при этом сегмент /getimage контролировался специальным контроллером, который для ознакомления лежит
         в этой же папке (см. `ImagesController.class.php`) 

Указанный контроллер по сути:

* Определял путь до картинки по id (запрос к базе)
* Далее просто парсил последнюю секцию (напр  `257x121xS/`) чтобы понять в каком виде нужна картинка, 
далее если изображение уже было, оно просто возвращалось   (с поддержкой загловка последнего кеширования), если же не было 
 то в дело вступал ImageManager (тут переименован в `ImageManager`), который просто умел обрабатывать и сохранять  файлы по уже переданным параметрам.


## Что предлагатеся переделать

1. Внести функционал парсинга параметров и поиск существующего изображени, и его отдачу с датой последнего иземения в `ImageManager`
2. Тогда в любом движке достаточно будет написать контролеер, который  "держит", скажем тот же базовый url `image`
   и умеет выделить и передать путь (если в щаблоне узказывается путь к изорбажению, а не id) и формат.
3. Например сторка ,для которой нужно всё это выделять может выглядеть так: 
`src="/image/ФОРМАТ/путь/к/картинке/файл.расширение`
 например:
```
<img src="/image/257x121xS/uploads/images/user/smile.jpg>
```

Также неплохо было бы добавить поддержку рыбы, просто возвращая изображение с выставлением заголовков


## Старая документация

Ниже документация для ознакомления. Вам же предлагается написать новую, после выполнения пунктов указаных выше.

####  Быстрое получение картинок ####
Получение картинки указанного размера по id (xS - фиксированная обрезка):
```xml
<a href="{$Image.link}">
      <span class="hold-img"><img src="/getimage/{$Image.imageID}/257x121xS/" alt="image"/></span>
	{$Image.title}
 </a>
```

#####  Рыба, на случай если картинки нет #####
Можно получить картинку, с возможной заменой на "рыбу" таким способом (обратите внимание на **знак нижнего подчеркивания** перед `ID` изображения):
```xml
<img src="/getimage/_{$project.headerImageID}/283x176xS" alt="image" width="283" height="176" />
```
-- если `$project.headerImageID` окажется пустым, то вернётся случайная картинка из папки `/uploaded/rybi` (см. `\bitplatform\trunk\libs\FileManager\ImageManager.class.php`), причём она будет отформатирована указанным образом (в примере выше это `283x176xS`).


#####  Пропорциональная обрезка изображения #####

Код (обратите внимание на `p` после `S`):
```xml
<img src="/getimage/_{$image.imageID}/253x183xSp/" alt="image"   />
```
Подгонит (обрежет) изображение под пропорцию `253 на 183`, при этом сохранив его максимальную площадь (то есть будет просто уменьшена та сторона, которая "вылазит" за пропорцию).
См. реализацию вычисления новых размеров в функции:
```php
ImageManager::getMaxProportionalWidthAndHeight()
```

